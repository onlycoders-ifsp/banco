CREATE OR REPLACE FUNCTION FN_VERIFCAR_LOGIN(P_LOGIN TEXT, P_SENHA TEXT)
RETURNS SETOF RECORD AS $$
DECLARE IS_CORRECT BOOLEAN;
DECLARE USUARIO TEXT;
BEGIN

	RETURN QUERY
	SELECT 
	CAST(U.ID_USUARIO AS TEXT),
	U.ATIVO
	--INTO IS_CORRECT, USUARIO
	FROM AUTENTIFICACAO A
	INNER JOIN USUARIOS U
	ON U.ID_USUARIO = A.ID_USUARIO
	WHERE A.LOGIN = P_LOGIN
	and (A.PASSWORD = CRYPT(P_SENHA,A.PASSWORD));
	
	/*
	IF IS_CORRECT THEN
		RETURN USUARIO;
	ELSE
		RETURN NULL;
	END IF;
	*/
	
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO VERIFICAR O LOGIN', sqlstate, sqlerrm, 'FN_VERIFCAR_LOGIN', 'AUTENTIFICACAO', CURRENT_QUERY());
		RETURN;
END;
$$  LANGUAGE plpgsql

/*
SELECT FN_VERIFCAR_LOGIN('testedebancov4@alugo.com', 'aaabbbccc')
*/