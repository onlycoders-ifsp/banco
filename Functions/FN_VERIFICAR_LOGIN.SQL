CREATE OR REPLACE FUNCTION FN_VERIFCAR_LOGIN(P_LOGIN TEXT)
RETURNS SETOF RECORD AS $$
BEGIN

	RETURN QUERY
	SELECT 
	CAST(A.ID_USUARIO AS TEXT),
	CASE WHEN A.LOGIN = U.EMAIL THEN CAST(LOWER(A.LOGIN) AS TEXT) ELSE CAST(A.LOGIN AS TEXT) END,
	CAST(A.PASSWORD AS TEXT),
	A.ADMIN,
	U.ATIVO
	FROM AUTENTIFICACAO A
	INNER JOIN USUARIOS U
	ON U.ID_USUARIO = A.ID_USUARIO
	WHERE (A.LOGIN = P_LOGIN OR U.EMAIL = LOWER(P_LOGIN));--((A.LOGIN = P_LOGIN AND P_LOGIN_TYPE = "username")
	--OR (U.EMAIL = P_LOGIN AND P_LOGIN_TYPE = "email"));
		
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO VERIFICAR O LOGIN', sqlstate, sqlerrm, 'FN_VERIFCAR_LOGIN', 'AUTENTIFICACAO', CURRENT_QUERY(), P_LOGIN);
		RETURN;
END;
$$  LANGUAGE plpgsql