CREATE OR REPLACE FUNCTION LOG_DDL()

  RETURNS EVENT_TRIGGER AS $$

DECLARE
  
BEGIN

  IF UPPER(TG_TAG) NOT LIKE 'DROP%'

  THEN

    INSERT INTO LOG.LOG_DDL (OPERACAO, OBJETO) 
	SELECT TG_TAG, OBJECT_IDENTITY
	FROM PG_EVENT_TRIGGER_DDL_COMMANDS(); --(TG_TAG, R.OBJECT_IDENTITY);

  END IF;

END;

$$ LANGUAGE 'plpgsql';

CREATE OR REPLACE FUNCTION LOG_DDL_DROP()

  RETURNS EVENT_TRIGGER AS $$

DECLARE

BEGIN

  IF UPPER(TG_TAG) LIKE 'DROP%' THEN
	  
	INSERT INTO LOG.LOG_DDL (OPERACAO, OBJETO) 
	SELECT TG_TAG, OBJECT_IDENTITY
	FROM PG_EVENT_TRIGGER_DROPPED_OBJECTS() ;

  END IF;

END;

$$ LANGUAGE 'plpgsql';

CREATE EVENT TRIGGER LOG_DDL_INFO ON DDL_COMMAND_END EXECUTE PROCEDURE LOG_DDL();

CREATE EVENT TRIGGER LOG_DDL_DROP_INFO ON SQL_DROP EXECUTE PROCEDURE LOG_DDL_DROP();