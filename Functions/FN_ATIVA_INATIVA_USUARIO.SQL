CREATE OR REPLACE FUNCTION FN_ATIVA_INATIVA_USUARIO(P_ID_USUARIO TEXT,P_USUARIO TEXT, P_MOTIVO TEXT)
    RETURNS BOOLEAN AS $$
BEGIN

    UPDATE USUARIOS
    SET ATIVO = CASE ATIVO
                    WHEN TRUE THEN FALSE
                    ELSE TRUE
        END
    WHERE ID_USUARIO = UUID(P_ID_USUARIO);

    INSERT INTO USUARIOS_ATIVO_INATIVO(
        ID_USUARIO,
        ATIVO,
        MOTIVO,
        USUARIO_ALTERACAO)
	SELECT
		ID_USUARIO,
        ATIVO,
		CASE ATIVO
			WHEN TRUE THEN ''
			ELSE P_MOTIVO
		END,
        P_USUARIO
	FROM USUARIOS
	WHERE ID_USUARIO = UUID(P_ID_USUARIO);

    RETURN TRUE;

EXCEPTION WHEN OTHERS THEN
    PERFORM FN_REPORT_ERRO('ERRO AO DELETAR USUARIO', SQLSTATE, SQLERRM, 'FN_ATIVA_INATIVA_USUARIO', 'USUARIOS', CURRENT_QUERY(), P_USUARIO);
    RETURN FALSE;
END;
$$ LANGUAGE PLPGSQL;
