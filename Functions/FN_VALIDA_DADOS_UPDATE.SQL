CREATE OR REPLACE FUNCTION FN_VALIDA_DADOS_UPDATE(VALIDADOR TEXT, P_ID_USUARIO TEXT, OPCAO INT)
RETURNS BOOLEAN AS $$
DECLARE OK BOOLEAN;
DECLARE OK_EMAIL BOOLEAN;
BEGIN

	IF(OPCAO = 1) THEN
		SELECT (VALIDADOR = CPF)
		INTO OK
		FROM USUARIOS
		WHERE CPF = VALIDADOR AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF OK THEN
			RETURN TRUE;
		END IF;
		
		RETURN FALSE;

	ELSIF(OPCAO = 2) THEN
		SELECT (LOWER(VALIDADOR) = LOWER(EMAIL))
		INTO OK
		FROM USUARIOS
		WHERE LOWER(EMAIL) = LOWER(VALIDADOR) AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF OK THEN
			RETURN TRUE;
		END IF;
		
		RETURN FALSE;
	ELSE
		SELECT (VALIDADOR = LOGIN)
		INTO OK
		FROM AUTENTIFICACAO
		WHERE LOGIN = VALIDADOR AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF NOT OK THEN
			OK := FALSE;
		END IF;
		
		SELECT (LOWER(VALIDADOR) = LOWER(EMAIL))
		INTO OK_Email
		FROM USUARIOS
		WHERE LOWER(EMAIL) = LOWER(VALIDADOR) AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF NOT OK_Email THEN
			OK_Email := FALSE;
		END IF;
		
		IF OK OR OK_Email THEN
			RETURN TRUE;
		ELSE
			RETURN FALSE;
		END IF;
	END IF;
	
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO VALIDAR DADOS', sqlstate, sqlerrm, 'FN_VALIDA_DADOS', 'USUARIOS/AUTENTIFICACAO', CURRENT_QUERY());
		RETURN FALSE;
END;
$$  LANGUAGE PLPGSQL