CREATE OR REPLACE FUNCTION FN_VALIDA_DADOS_UPDATE(VALIDADOR TEXT, P_ID_USUARIO TEXT, OPCAO INT)
RETURNS BOOLEAN AS $$
DECLARE OK BOOLEAN;
BEGIN

	IF(OPCAO = 1) THEN
		SELECT (VALIDADOR = CPF)
		INTO OK
		FROM USUARIOS
		WHERE CPF = VALIDADOR AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF OK IS NULL THEN
			OK := FALSE;
		END IF;
		
		RETURN OK;

	ELSIF(OPCAO = 2) THEN
		SELECT (VALIDADOR = EMAIL)
		INTO OK
		FROM USUARIOS
		WHERE EMAIL = VALIDADOR AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF OK IS NULL THEN
			OK := FALSE;
		END IF;
		
		RETURN OK;
	ELSE
		SELECT (VALIDADOR = LOGIN)
		INTO OK
		FROM AUTENTIFICACAO
		WHERE LOGIN = VALIDADOR AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF OK IS NULL THEN
			OK := FALSE;
		END IF;
		
		SELECT (VALIDADOR = EMAIL)
		INTO OK
		FROM USUARIOS
		WHERE EMAIL = VALIDADOR AND UUID(P_ID_USUARIO) <> ID_USUARIO;
		
		IF OK IS NULL THEN
			OK := FALSE;
		END IF;
		
		RETURN OK;
	END IF;
	
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO VALIDAR DADOS', sqlstate, sqlerrm, 'FN_VALIDA_DADOS', 'USUARIOS/AUTENTIFICACAO', CURRENT_QUERY());
		RETURN FALSE;
END;
$$  LANGUAGE PLPGSQL