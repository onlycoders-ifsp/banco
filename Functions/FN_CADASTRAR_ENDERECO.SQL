CREATE OR REPLACE FUNCTION 
FN_CADASTRAR_ENDERECO(P_ID_USUARIO UUID, P_CEP VARCHAR(20), P_LOGRADOURO TEXT, 
						P_COMPLEMENTO VARCHAR(20), P_BAIRRO VARCHAR(50), P_NUMERO VARCHAR(20))
RETURNS BOOLEAN AS $$
BEGIN

	IF EXISTS (SELECT ID_USUARIO FROM ENDERECO WHERE ID_USUARIO = P_ID_USUARIO) THEN
		BEGIN
			UPDATE ENDERECO
			SET CEP = P_CEP, LOGRADOURO = P_LOGRADOURO, COMPLEMENTO = P_COMPLEMENTO,
			BAIRRO = P_BAIRRO, NUMERO = P_NUMERO
			WHERE ID_USUARIO = P_ID_USUARIO;

			EXCEPTION WHEN OTHERS THEN
				PERFORM FN_REPORT_ERRO('ERRO AO ATUALIZAR ENDEREÇO', SQLSTATE, SQLERRM, 'FN_CADASTRAR_ENDERECO', 'ENDERECO', CURRENT_QUERY());
				RETURN FALSE;
		END;
	ELSE
	
	INSERT INTO ENDERECO(
		ID_USUARIO, 
		CEP,
		LOGRADOURO, 
		COMPLEMENTO,
		BAIRRO,
		NUMERO)
	VALUES(
		P_ID_USUARIO, 
		P_CEP, 
		P_LOGRADOURO,
		P_COMPLEMENTO,
		P_BAIRRO,
		P_NUMERO);
	END IF;
	
	RETURN TRUE;

	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO CADASTRAR ENDEREÇO', SQLSTATE, SQLERRM, 'FN_CADASTRAR_ENDERECO', 'ENDERECO', CURRENT_QUERY());
		RETURN FALSE;
END;
$$ LANGUAGE PLPGSQL;

/*
SELECT FN_CADASTRAR_ENDERECO('8c94f74e-6811-457c-8a8e-0434c1efa5cb','d93d6170-5ecf-4c2c-95ff-cc75a12aeebb',
							'04337-020','R. Capitão', 'Americanópolis','111')
*/