	CREATE OR REPLACE FUNCTION FN_RETORNA_ALUGUEL(P_ID_USUARIO TEXT, P_ID_ALUGUEL TEXT, P_ID_PRODUTO TEXT)
	RETURNS SETOF RECORD AS $$
	--DECLARE DADOS JSON;
	BEGIN

		IF P_ID_USUARIO = '0' THEN
			P_ID_USUARIO := NULL;
		END IF;
		
		IF P_ID_ALUGUEL = '0' THEN
			P_ID_ALUGUEL := NULL;
		END IF;
		
		IF P_ID_PRODUTO = '0' THEN
			P_ID_PRODUTO := NULL;
		END IF;
		
		RETURN QUERY 
			SELECT
			CAST(A.ID_ALUGUEL AS TEXT),
			CAST(P.ID_PRODUTO AS TEXT),
			CAST(P.NOME AS TEXT),
			CAST(LOCATARIO.ID_USUARIO AS TEXT),
			CAST(LOCATARIO.NOME AS TEXT),
			CAST(LOCADOR.NOME AS TEXT),
			TO_CHAR(A.DATA_INICIO,'YYYY-MM-DD HH24:MI:SS'),
			TO_CHAR(A.DATA_FIM,'YYYY-MM-DD HH24:MI:SS'),
			CAST(A.VALOR_ALUGUEL AS DECIMAL(18,2)),
			CAST(A.VALOR_DEBITO AS DECIMAL(18,2)),
			TO_CHAR(A.DATA_SAQUE,'YYYY-MM-DD')
			FROM ALUGUEIS A
			
			INNER JOIN USUARIOS LOCADOR
			ON A.ID_USUARIO = LOCADOR.ID_USUARIO
			
			INNER JOIN PRODUTOS P
			ON P.ID_PRODUTO = A.ID_PRODUTO
			
			INNER JOIN USUARIOS LOCATARIO
			ON LOCATARIO.ID_USUARIO = P.ID_USUARIO
			
			WHERE (A.ID_ALUGUEL = UUID(P_ID_ALUGUEL)
			OR (LOCADOR.ID_USUARIO = UUID(P_ID_USUARIO))
			OR (P.ID_PRODUTO = UUID(P_ID_PRODUTO))
			OR (P_ID_ALUGUEL IS NULL AND P_ID_USUARIO IS NULL AND P_ID_PRODUTO IS NULL));
		
		EXCEPTION WHEN OTHERS THEN
			PERFORM FN_REPORT_ERRO('ERRO AO SELECIONAR ALUGUEL', SQLSTATE, SQLERRM, 'FN_RETORNA_ALUGUEL', 'ALUGUEIS', CURRENT_QUERY());
	END;
	$$ LANGUAGE PLPGSQL;