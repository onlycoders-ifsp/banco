CREATE OR REPLACE FUNCTION FN_RETORNAR_PRODUTO(P_ID_USUARIO UUID DEFAULT NULL)
RETURNS SETOF RECORD AS $$
BEGIN
	 
	RETURN QUERY 
		SELECT P.DI_USUARIO, U.NOME, P.NOME, P.DESCRICAO, P.VALOR_BASE_DIARIA,
		P.VALOR_BASE_MENSAL, P.VALOR_PRODUTO
		FROM PRODUTOS P
		INNER JOIN USUARIOS U
		ON P.ID_USUARIO = U.ID_USUARIO
		WHERE (U.ID_USUARIO = P_ID_USUARIO OR P_ID_USUARIO IS NULL);

	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO SELECIONAR PRODUTO', SQLSTATE, SQLERRM);

END;
$$ LANGUAGE PLPGSQL;

/* SEM PARAMENTRO RETORNA TUDO
SELECT *FROM FN_RETORNAR_PRODUTO() -- OU SELECT *FROM FN_RETORNAR_PRODUTO('fc638b3d-cdec-4a94-9177-2d583effec33')
			AS T(ID_PRODUTO TEXT, NOME_USUARIO TEXT, NOME_PRODUTO TEXT, DESCRICAO TEXT, VALOR_BASE_DIARIA DECIMAL(16,2), 
				 VALOR_BASE_MENSAL DECIMAL(16,2), VALOR_PRODUTO DECIMAL(16,2));
*/