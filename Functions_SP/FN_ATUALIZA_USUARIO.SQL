CREATE OR REPLACE FUNCTION 
FN_ATUALIZA_USUARIO(P_ID_USUARIO UUID, P_NOME TEXT, P_LOGRADOURO TEXT, 
					P_NUMERO VARCHAR(10), P_CEP VARCHAR(10), 
					P_EMAIL VARCHAR(50), P_SEXO INT, P_TELEFONE VARCHAR(20),
					P_CELULAR VARCHAR(20), P_DATA_NASCIMENTO DATE)
RETURNS BOOLEAN AS $$
BEGIN
	
	UPDATE USUARIOS
	SET NOME = P_NOME, LOGRADOURO = P_LOGRADOURO,
	NUMERO = P_NUMERO, CEP = P_CEP,
	EMAIL = P_EMAIL, DATA_NASCIMENTO = P_DATA_NASCIMENTO, 
	ID_SEXO = FN_GET_ID_SEXO(P_SEXO)
	WHERE ID_USUARIO = P_ID_USUARIO;
	
	UPDATE TELEFONES
	SET TELEFONE = P_TELEFONE, CELULAR = P_CELULAR
	WHERE ID_USUARIO = P_ID_USUARIO;
	
	RETURN TRUE;

	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO ATUALIZAR USUARIO', SQLSTATE, SQLERRM);
		RETURN FALSE;
END;
$$ LANGUAGE PLPGSQL;

/*
SELECT FN_ATUALIZA_USUARIO(
'8e7578b4-79dd-47f7-9c80-b0b7917166ab', 'Teste de update', 'Rua testando update', '145', '87654321',
'testandoupdate@laugoapp.com', 3, '6666666666', '777777777', '2020-05-01')
*/