CREATE OR REPLACE FUNCTION 
FN_ATUALIZA_USUARIO(P_ID_USUARIO UUID, P_NOME TEXT, P_LOGRADOURO TEXT, 
					P_NUMERO VARCHAR(10), P_CEP VARCHAR(10), P_EMAIL VARCHAR(50), 
					P_SEXO VARCHAR(50),	P_TELEFONE VARCHAR(20), 
					P_CELULAR VARCHAR(20), P_DATA_NASCIMENTO DATE)
RETURNS BOOLEAN AS $$
BEGIN
	
	BEGIN
		UPDATE USUARIOS
		SET NOME = P_NOME, EMAIL = P_EMAIL, LOGIN = P_LOGIN,
		SEXO = P_SEXO, DATA_NASCIMENTO = P_DATA_NASCIMENTO
		WHERE ID_USUARIO = P_ID_USUARIO;
		
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO ATUALIZAR USUARIO', SQLSTATE, SQLERRM);
		RETURN FALSE;
	END;
	
	BEGIN		
		UPDATE TELEFONES
		SET TELEFONE = P_TELEFONE, CELULAR = P_CELULAR
		WHERE ID_USUARIO = P_ID_USUARIO;
	
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO ATUALIZAR USUARIO', SQLSTATE, SQLERRM);
		RETURN FALSE;
	END;
	
	BEGIN
		UPDATE ENDERECO
		SET LOGRADOURO = P_LOGRADOURO, NUMERO = P_NUMERO,
		CEP = P_CEP
		WHERE ID_USUARIO = P_ID_USUARIO;
	
	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO ATUALIZAR USUARIO', SQLSTATE, SQLERRM);
		RETURN FALSE;
	END;
		
	RETURN TRUE;

	EXCEPTION WHEN OTHERS THEN
		PERFORM FN_REPORT_ERRO('ERRO AO ATUALIZAR USUARIO', SQLSTATE, SQLERRM);
		RETURN FALSE;
END;
$$ LANGUAGE PLPGSQL;

/*
SELECT FN_ATUALIZA_USUARIO(
'8e7578b4-79dd-47f7-9c80-b0b7917166ab', 'Teste de update', 'Rua testando update', '145', '87654321',
'testandoupdate@laugoapp.com', 3, '6666666666', '777777777', '2020-05-01')
*/